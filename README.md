# SecCheckSimulator：大型活动安检口压力测试仿真器

## 1. 项目概述

本项目是一个基于 `simpy` 的离散事件仿真程序，旨在模拟大型活动（如音乐节、体育赛事）中观众通过安检并进入场馆的全过程。

通过对数万名观众在数小时内集中到达的场景进行建模，本项目可以帮助活动组织方：
- **评估** 当前安检设施（通道数量、人员配置）的吞吐能力。
- **识别** 整个入场流程中的潜在瓶颈（如交通延迟、安检排队、下行拥堵等）。
- **量化** 不同策略调整（如增开通道、优化排队规则）对总体效率的影响。
- **预测** 在特定条件下，观众的平均等候时间和完成率等关键绩效指标（KPIs）。

最终输出为详细的 Excel 报告，为决策提供数据支持。

## 2. 核心流程

仿真完整模拟了单个观众从到达公园到成功入场的端到端旅程，主要包括以下步骤：

1.  **到达与交通延迟**: 观众根据预设的交通方式（如自驾、公交）随机到达，并经历不同的交通延迟。
2.  **公园内步行**: 观众在公园内步行至安检区，步行时间受路径长度和随机干扰影响。
3.  **选择安检大棚**: 系统设有两个安检大棚（北棚和南棚），观众会智能选择当前总排队人数较少的大棚。
4.  **选择安检通道**: 在选定的大棚内，观众会选择当前排队人数最少的具体安检通道进行排队。
5.  **安检过程**:
    - **排队等候**: 等待安检通道变为可用。
    - **安检处理**: 安检本身需要一定时间。
    - **失败与重试**: 存在一定概率安检失败，需要立即在原地重试。
    - **通道故障**: 每个通道在处理完一名观众后，有小概率发生临时故障，导致短时间不可用。
6.  **下行方式选择**: 安检通过后，观众需下行进入场馆。
    - **动态决策**: 观众会根据扶梯和楼梯的排队情况，动态选择概率。当扶梯排队人数过多时，更多人会倾向于选择楼梯。
7.  **完成入场**: 观众完成下行，计为成功入场。

整个仿真过程会由一个监控器（`monitor`）定期记录系统状态，如各区域的排队长度和资源使用率。

## 3. 输入：仿真参数配置

本项目的所有可调参数均集中在 `config.py` 文件中，方便进行统一管理和修改。无需修改代码，只需调整该文件即可进行不同场景的仿真实验。

**主要可配置参数包括：**

- **核心参数**:
    - `TOTAL_SPECTATORS`: 总观众人数。
    - `SIMULATION_DURATION_HOURS`: 仿真总时长。
- **设施参数**:
    - `TOTAL_SECURITY_LANES`: 安检通道总数。
    - `ESCALATOR_CAPACITY_PER_MIN`: 手扶电梯的通行能力。
- **行为参数**:
    - `TRANSPORT_PROBS`: 观众交通方式的概率分布。
    - `SECURITY_FAILURE_RATE`: 安检失败率。
    - `LANE_FAILURE_PROB_PER_PERSON`: 单个安检通道的故障概率。
- **决策规则**:
    - `ESCALATOR_QUEUE_THRESHOLD_FOR_ADJUST`: 触发"从扶梯转向楼梯"决策的排队人数阈值。
    - `DESCEND_INITIAL_PROBS` / `DESCEND_ADJUSTED_PROBS`: 不同情况下的下行方式选择概率。

## 4. 输出：仿真结果报告

仿真运行结束后，会在 `outputs/` 目录下生成一个名为 `simulation_results.xlsx` 的 Excel 文件。该文件包含三个工作表（Sheet）：

1.  **仿真结果汇总 (Summary)**:
    - 提供核心KPIs，如：总完成率、规定时间内完成人数、平均总耗时、平均安检排队时间等，让你对仿真结果一目了然。

2.  **所有观众详细数据 (Spectator Details)**:
    - 记录了**每一个**观众在仿真过程中的详细时间戳和耗时，包括到达时间、交通延迟、各阶段排队时长、最终完成时间等。可用于进行深度数据分析。

3.  **系统状态监控 (System State)**:
    - 按固定时间间隔（默认为60秒）记录了整个系统的状态快照，如南北安检口的排队人数、使用中的通道数、扶梯队列人数等。可用于绘制系统负载随时间变化的图表，直观地发现瓶颈发生的时间点。

## 5. 如何运行

**1. 安装依赖**

本项目依赖以下 Python 库：
```
pip install pandas simpy numpy openpyxl
```
或者使用 `requirements.txt` 文件:
```
pip install -r requirements.txt
```

**2. 修改配置 (可选)**

根据你的仿真需求，修改 `config.py` 文件中的参数。

**3. 运行仿真**

在项目根目录下，执行以下命令：
```
python main.py
```

**4. 查看结果**

仿真结束后，控制台会打印简要的汇总报告。详细数据请在 `outputs/simulation_results.xlsx` 文件中查看。

## 6. 项目结构

```
.
├── config.py               # 仿真参数配置文件，是主要输入
├── main.py                 # 程序主入口
├── simulation.py           # 核心仿真逻辑实现
├── requirements.txt        # 项目依赖
├── outputs/                # 存放输出报告的目录
│   └── .gitkeep            # 占位符
└── README.md               # 本文档
```
